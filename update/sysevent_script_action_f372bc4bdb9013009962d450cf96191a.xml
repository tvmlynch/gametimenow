<?xml version="1.0" encoding="UTF-8"?>
<record_update sys_domain="global" table="sysevent_script_action">
    <sysevent_script_action action="INSERT_OR_UPDATE">
        <active>true</active>
        <condition_script/>
        <description/>
        <event_name>sn_bball.game.inserted</event_name>
        <name>Get weather for game</name>
        <order>100</order>
        <script><![CDATA[(function() {
var msInDay = 1000 * 60 * 60 * 24;
var now = new GlideDateTime().getNumericValue();
var diff = 0, daysUntilGame = 0, scheduledDate = 0, weather;

var game = new GlideRecord("sn_bball_game"); 
	game.addQuery("game_date", ">", new GlideDateTime()); 
	game.query();

while(game.next()) {
scheduledDate = game.game_date.dateNumericValue(); 
	diff = scheduledDate - now;

if (diff < 1) diff = 0;

daysUntilGame = Math.floor(diff / msInDay);

weather = new WeatherFetcher().getWeather(daysUntilGame);

if (weather) {
game.setValue('projected_weather', weather); 
	game.update();

} else {
gs.error("Weather not updated for new game {0}",

game.getDisplayValue()); }

} })()]]></script>
        <synchronous>false</synchronous>
        <sys_class_name>sysevent_script_action</sys_class_name>
        <sys_created_by>tricia.lynch</sys_created_by>
        <sys_created_on>2018-02-19 20:12:24</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>f372bc4bdb9013009962d450cf96191a</sys_id>
        <sys_mod_count>5</sys_mod_count>
        <sys_name>Get weather for game</sys_name>
        <sys_overrides/>
        <sys_package display_value="GameTimeNow" source="sn_bball">2811225c9f3112005ca47fc9c42e7022</sys_package>
        <sys_policy/>
        <sys_scope display_value="GameTimeNow">2811225c9f3112005ca47fc9c42e7022</sys_scope>
        <sys_update_name>sysevent_script_action_f372bc4bdb9013009962d450cf96191a</sys_update_name>
        <sys_updated_by>tricia.lynch</sys_updated_by>
        <sys_updated_on>2018-02-19 21:06:45</sys_updated_on>
    </sysevent_script_action>
</record_update>
